<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket.IO Connection Test</title>
  <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script> <!-- Include Socket.IO client -->
</head>
<body>

  <h1>Socket.IO Connection Test</h1>
  <p>Check the browser console for Socket.IO connection logs.</p>

  <label for="merchantName">Merchant Name:</label>
  <input type="text" id="merchantName" value="M123" name="merchantName"><br><br>

  <label for="key">Key:</label>
  <input type="text" id="key" value="key123" name="key"><br><br>

  <label for="posName">POS Name:</label>
  <input type="text" id="posName" value="test POS" name="posName"><br><br>

  <label for="msg">Message:</label>
  <input type="text" id="msg" value="dfgsfg" name="msg"><br><br>

  <button id="sendButton">Send</button>

  <p id="response"></p>

  <script>
    // Create a new Socket.IO connection
    socket = io('http://localhost:9500', {
      query: {
        merchantName: merchantName,
        posName: posName,
        PosId: 'key123' // If you have PosId, pass it here
      }
    });
    // Handle connection open
    socket.on('connect', function () {
      console.log('Socket.IO connected to http://localhost:9500');
    });

    // Handle messages received from the server and update the <p> tag
    socket.on('message', function (data) {
      const parsedData = JSON.parse(data); // Parse the data once
      console.log('Message from server:', parsedData);

      if (parsedData.isResponse && parsedData.msg === "Login successful") {
        document.getElementById('response').innerHTML = 'Response: ' + parsedData.msg + '!!!'; // Update the response paragraph
      // } else {
      //   document.getElementById('response').innerHTML = 'Response: ' + parsedData.msg;
      }
    });

    // Handle errors
    socket.on('connect_error', function (error) {
      console.error('Socket.IO connection error:', error);
    });

    // Handle connection close
    socket.on('disconnect', function () {
      console.log('Socket.IO connection closed.');
      document.getElementById('response').innerHTML = 'Socket disconnected.';
    });

    // Send button click event
    document.getElementById('sendButton').addEventListener('click', function() {
      const merchantName = document.getElementById('merchantName').value;
      const key = document.getElementById('key').value;
      const posName = document.getElementById('posName').value;
      const msg = document.getElementById('msg').value;

      const data = {
        Action: 'login',
        MerchantName: merchantName,
        Key: key,
        PosName: posName,
        Msg: msg
      };

      socket.emit('message', data);

      console.log('Login message sent to the server:', data);
    });

  </script>

</body>
</html>
