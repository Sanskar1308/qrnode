<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Connection Test</title>
</head>
<body>

  <h1>WebSocket Connection Test</h1>
  <p>Check the browser console for WebSocket connection logs.</p>

  <label for="merchantName">Merchant Name:</label>
  <input type="text" id="merchantName" value="M123" name="merchantName"><br><br>

  <label for="key">Key:</label>
  <input type="text" id="key" value="key123" name="key"><br><br>

  <label for="posName">POS Name:</label>
  <input type="text" id="posName" value="test POS1" name="posName"><br><br>

  <label for="msg">Message:</label>
  <input type="text" id="msg" value="dfgsfg" name="msg"><br><br>

  <button id="sendButton">Send</button>

  <p id="response"></p>

  <script>
    // Read apiKey from input field
    const key = document.getElementById('key').value;

    // Create a new WebSocket connection with apiKey as a query parameter
    const socket = new WebSocket(`ws://localhost:9500?apiKey=${key}`); // Attach apiKey in URL

    // Handle connection open
    socket.onopen = function () {
      console.log('WebSocket connected to ws://localhost:9500');
    };

    // Handle messages received from the server
    socket.onmessage = function (event) {
      console.log('Message received from server:', event.data);
      
      try {
        const parsedData = JSON.parse(event.data);
        console.log('Parsed message from server:', parsedData);

        // If the message is a successful login, update the response element
        if (parsedData.isResponse && parsedData.msg === "Login successful") {
          document.getElementById('response').innerHTML = 'Response: ' + parsedData.msg + '!!!';
        }
      } catch (e) {
        console.error('Error parsing message:', e);
      }
    };

    // Handle errors
    socket.onerror = function (error) {
      console.error('WebSocket connection error:', error);
    };

    // Handle connection close
    socket.onclose = function () {
      console.log('WebSocket connection closed.');
      document.getElementById('response').innerHTML = 'WebSocket disconnected.';
    };

    // Send button click event
    document.getElementById('sendButton').addEventListener('click', function() {
      const merchantName = document.getElementById('merchantName').value;
      const key = document.getElementById('key').value;
      const posName = document.getElementById('posName').value;
      const msg = document.getElementById('msg').value;

      const data = {
        Action: 'login',
        MerchantName: merchantName,
        Key: key,
        PosName: posName,
        Msg: msg
      };

      console.log('Sending login data:', data);
      socket.send(JSON.stringify(data)); // Send JSON string over WebSocket
    });
  </script>
</body>
</html>
